<html>
  <head>
    <!-- Good ol' Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@545&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

    <!-- Custom styles -->
    <link rel="stylesheet" href="/base.css">

    <!-- Metadata -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FlexExam</title>
  </head>
  <body style="user-select:none">
    <hr style="height:5px;margin-top:0;background-color:#222">
    <div class="container w-75 p-0">
      <nav class="navbar navbar-expand-lg navbar-light bg-light mx-0 mt-2 mb-0">
        <h4 class="mb-0">FlexExam</h4>
      </nav>
    </div>
    <hr>
    <br>
    <br>
    <br>
    <div class="container w-75">
      <!-- REMEMBER TO ADD RED BOXES IF ENTRIES ARE EMPTY -->
      <div class="row">
        <div class="col-md-8">
          <form id="info-form" onsubmit="return false;">
            <input type="hidden" id="testid" name="testid" value="">
            <h3>Enter Your Personal Information</h3>
            <p>
              All fields are required.
            </p>
            <br>
            <div class="row">
              <div class="col-md">
                <div class="form-group">
                  <label for="firstname">First Name</label>
                  <input
                    id="firstname"
                    name="firstname"
                    class="form-control fe-formcontrol"
                    type="search"
                    required
                    placeholder="Enter your first name"
                    autocomplete="off"
                    spellcheck="false"
                    >
                </div>
              </div>
              <div class="col-md">
                <div class="form-group">
                  <label for="lastname">Last Name</label>
                  <input
                    id="lastname"
                    name="lastname"
                    class="form-control fe-formcontrol"
                    type="search"
                    required
                    placeholder="Enter your last name"
                    autocomplete="off"
                    spellcheck="false"
                    >
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-5">
                <label for="date-month">Date of Birth</label>
                <div style="position: relative">
                  <select class="form-control fe-select" name="date-month" id="date-month" class="required">
                    <option selected="" value="">Month</option>
                    <option value="Jan">January</option>
                    <option value="Feb">February</option>
                    <option value="Mar">March</option>
                    <option value="Apr">April</option>
                    <option value="May">May</option>
                    <option value="Jun">June</option>
                    <option value="Jul">July</option>
                    <option value="Aug">August</option>
                    <option value="Sep">September</option>
                    <option value="Oct">October</option>
                    <option value="Nov">November</option>
                    <option value="Dec">December</option>
                  </select>
                  <span class="fe-select-arrow">
                    <img
                      src="/assets/chevron-down-solid.svg"
                      width="12px"
                      height="12px"
                      style="position: absolute; color: #EEE; top: calc(50% - 6px); left: calc(50% - 7px)"
                      >
                  </span>
                </div>
              </div>
              <div class="col date-col">
                <div class="form-group">
                  <label for="date-day">&nbsp;</label>
                  <input
                    id="date-day"
                    name="date-day"
                    class="form-control fe-formcontrol"
                    required
                    type="number"
                    placeholder="Day"
                    autocomplete="off"
                    spellcheck="false"
                    max="31"
                    min="1"
                    >
                </div>
              </div>
              <div class="col">
                <div class="form-group">
                  <label for="date-year">&nbsp;</label>
                  <input
                    id="date-year"
                    name="date-year"
                    class="form-control fe-formcontrol"
                    type="number"
                    placeholder="Year (4 digits)"
                    autocomplete="off"
                    spellcheck="false"
                    max="2019"
                    min="1900"
                    >
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md">
                <div class="form-group">
                  <label class="mb-0" for="firstname">Email Address</label>
                  <p class="mt-0 mb-2"><small>Enter the email address associated with your FlexExam account.</small></p>
                  <input
                    id="email"
                    name="email"
                    class="form-control fe-formcontrol"
                    type="email"
                    placeholder="Enter your email address"
                    autocomplete="off"
                    spellcheck="false"
                    >
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md">
                <div class="form-group">
                  <label class="mb-1 mt-2" for="firstname">Confirm Email Address</label>
                  <input
                    id="confirm-email"
                    name="confirm-email"
                    class="form-control fe-formcontrol"
                    type="email"
                    placeholder="Reenter your email address"
                    autocomplete="off"
                    spellcheck="false"
                    >
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md">
                <label for="testing-location">Testing Location</label>
                <div style="position: relative">
                  <select class="form-control fe-select" name="testing-location" id="testing-location" class="required">
                    <option value="">Select an option</option>
                    <option value="home">Home</option>
                    <option value="school">School</option>
                    <option value="other">Other</option>
                  </select>
                  <span class="fe-select-arrow">
                    <img
                      src="/assets/chevron-down-solid.svg"
                      width="12px"
                      height="12px"
                      style="position: absolute; color: #EEE; top: calc(50% - 6px); left: calc(50% - 7px)"
                      >
                  </span>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md">
                <br>
                <p>Permission To Reuse</p>
                <p style="font-size:0.9em">
                  I grant FlexExam the unlimited right to use, reproduce, and publish my free-response materials, both written and oral, for educational research and instructional purposes. My name and the name of my school will not be used in any way in connection with my free-response materials. I understand that I am free to mark "Decline" with no effect on my score or its reporting.
                </p>
              </div>
            </div>
            <div class="row">
              <div class="col-md">
                <div class="d-flex">
                  <div class="custom-control custom-radio mr-3">
                    <input type="radio" id="accept-perms" name="accept-perms" class="custom-control-input">
                    <label class="custom-control-label" for="accept-perms">Accept</label>
                  </div>
                  <div class="custom-control custom-radio">
                    <input type="radio" id="decline-perms" name="decline-perms" class="custom-control-input">
                    <label class="custom-control-label" for="decline-perms">Decline</label>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md">
                <hr class="mt-4 mb-4">
                <p>Terms and Conditions<p>
              </div>
            </div>
            <div class="row">
              <div class="col-md">

                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="accept-terms" name="accept-terms">
                  <label class="custom-control-label" for="accept-terms">I agree to the <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">Terms and Conditions</a></label>
                </div>
              </div>
            </div>
            <p id="error" class="mt-2 mb-0" style="color: #a00"></p>
            <br>
            <input id="submit" type="submit" class="btn btn-primary fe-btn" disabled value="Continue">
          </form>
        </div>
        <div class="col-md-4">
        </div>
      </div>
    </div>
    <!-- Our code -->
    <script>
      // Set TestID
      Cookies.get("flexexam-testid");
      $("#testid").val(Cookies.get("flexexam-testid"));

      // Submit info
      $("#info-form").validate({
        rules: {
          "accept-terms": {
            required: true
          },
          "confirm-email": {
            equalTo: "#email"
          }
        },
        errorPlacement: function(label, element) {
          console.log(label, element);
          label.addClass('fe-errormsg');
          element.addClass('fe-formerror');
          label.insertAfter(element);
        },
        success: function(label, element) {
          console.log("succ");
          console.log(element);
          element.classList.remove('fe-formerror');
          if ($("#info-form").validate().checkForm()) {
            $("#submit").prop("disabled", false);
          }
        },
        submitHandler: function() {
          $.post("/api/" + $("#testid").val(), $("#info-form").serialize())
            .done(function(data) {
              console.log(data);
              Cookies.set("flexexam-token", data);
              window.location.href = "/waiting";
            })
            .fail(function(jqXHR) {
              console.error("Submit failed!");
            });
        },
        invalidHandler: function(event, validator) {
          console.log(validator);
        }
      });

      // Select field error handling
      $(".fe-select").change(function(e) {
        if (e.target.value === "") {
          console.log($(this).parent());
          $(this).toggleClass("fe-formerror", true);
          $(this).parent().parent().append('<label class="fe-errormsg">This field is required.</label>');
        } else {
          $(this).toggleClass("fe-formerror", false);
          if ($(this).parent().next().is("label")) {
            $(this).parent().next().remove();
          }
        }
      });

    </script>
  </body>
</html>
